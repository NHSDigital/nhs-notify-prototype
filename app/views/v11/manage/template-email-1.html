{% extends 'v11/layout.html' %}

{% block head %}

<!-- Script to convert markdown to formatted content -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/2.1.0/showdown.min.js"></script>
<script>
window.onload = function () {
  var text = document.getElementById('sourceTA').value,
      target = document.getElementById('targetDiv'),
      converter = new showdown.Converter({noHeaderId: true, simpleLineBreaks: true, simplifiedAutoLink: false}),
      html = converter.makeHtml(text);
    
    target.innerHTML = html;
}
</script>

{% endblock %}

{% block beforeContent %}
{% endblock %}

{% block outerContent %}

{{ backLink({
  "href": "templates",
  "text": "Back to all templates",
  "classes": "nhsuk-u-margin-top-4 nhsuk-u-margin-bottom-0"
}) }}

{% endblock %}

{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-full">

      {% if data['show-save-banner'] == 'yes' %}
      <div class="notify-confirmation-panel">
        <h1 class="nhsuk-heading-l nhsuk-u-margin-bottom-0">Template saved</h1>
      </div>
      {% endif %}

      <h1 class="nhsuk-heading-xl">
        {{ data['template-email-name-1'] }}
      </h1>

      {% if data['template-email-name-1-approved'] != '1' %}

      <div class="nhsuk-u-margin-bottom-6">

        <p class="nhsuk-u-margin-bottom-3">
          {{ tag({
            text: "Unlocked",
            classes: "nhsuk-u-margin-right-2"
          })}}
        </p>
  
        {{ details({
          text: "Show messages this template is assigned to",
          HTML: '
            <p>
              <strong class="nhsuk-tag nhsuk-tag--blue">
                Draft
              </strong> 
              <a href="">Message name 1</a>
            </p>
            <p>
              <strong class="nhsuk-tag nhsuk-tag--blue">
                Draft
              </strong> 
              <a href="">Message name 2</a>
            </p>
            <p>
              <strong class="nhsuk-tag nhsuk-tag--blue">
                Draft
              </strong> 
              <a href="">Message name 3</a>
            </p>
          ',
          classes: 'nhsuk-u-margin-bottom-0'
        }) }}

      </div>

      {% else %}

      <div class="nhsuk-warning-callout-nhs-notify nhsuk-u-padding-4 nhsuk-u-margin-bottom-6">

        <p class="nhsuk-u-margin-bottom-3">
          {{ tag({
            text: "Locked",
            classes: "nhsuk-u-margin-right-2 nhsuk-tag--orange"
          })}}
          You cannot edit this template as it's assigned to messages in production.
        </p>

        {{ details({
          text: "Show messages this template is assigned to",
          HTML: '
          <p>
            <strong class="nhsuk-tag nhsuk-tag--red">
              Production
            </strong> 
            <a href="">Message name 1</a>
          </p>
          <p>
            <strong class="nhsuk-tag nhsuk-tag--red">
              Production
            </strong> 
            <a href="">Message name 2</a>
          </p>
          <p>
            <strong class="nhsuk-tag nhsuk-tag--blue">
              Draft
            </strong> 
            <a href="">Message name 3</a>
          </p>
          ',
          classes: 'nhsuk-u-margin-bottom-0'
        }) }}

      </div>

      {% endif %}

      <table role="table" class="notify-template-content nhsuk-u-margin-bottom-4">
        <tbody class="nhsuk-table__body">

          <tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell" style="width:20%;">
              Template ID
            </th>
            <td role="cell" class="nhsuk-table__cell">
              email-a4b171b5-431f-4a5b-9d7a-9a4903c98e66
            </td>
          </tr>

          <tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell">
              Type
            </th>
            <td role="cell" class="nhsuk-table__cell">
              Email
            </td>
          </tr>

          <!--<tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell" style="width:20%;">
              Status
            </th>
            <td role="cell" class="nhsuk-table__cell">
              
              {% if data['template-email-name-1-approved'] == '1' %}

              {{ tag({
                text: "Locked",
                classes: "nhsuk-u-margin-bottom-2 nhsuk-tag--red"
              })}}

              {% else %}

              {{ tag({
                text: "Unlocked",
                classes: "nhsuk-u-margin-bottom-2"
              })}}

              {% endif %}

              {{ details({
                classes: 'nhsuk-expander',
                text: 'Message plans this template is assigned to',
                HTML: '
                <ul>
                  <li>
                    <a href="">Message name 1</a>
                    {{ tag({
                      text: "Draft",
                      classes: "nhsuk-tag--blue"
                    })}}
                  </li>
                  <li>
                    <a href="">Message name 2</a>
                    {{ tag({
                      text: "Draft",
                      classes: "nhsuk-tag--blue"
                    })}}
                  </li>
                  <li>
                    <a href="">Message name 3</a>
                    {{ tag({
                      text: "Production",
                      classes: "nhsuk-tag--red"
                    })}}
                  </li>
                </ul>'
              }) }}

              <p class="nhsuk-u-margin-bottom-0 nhsuk-u-margin-top-2">This template is assigned to messages in production.</p>

              {{ details({
                text: "Message plans this template is assigned to",
                HTML: '
                <ul>
                  <li>
                    <a href="">Message name 1</a>
                    <strong class="nhsuk-tag nhsuk-tag--blue">
                      Draft
                    </strong>
                  </li>
                  <li>
                    <a href="">Message name 2</a>
                    <strong class="nhsuk-tag nhsuk-tag--blue">
                      Draft
                    </strong>
                  <li>
                    <a href="">Message name 3</a>
                    <strong class="nhsuk-tag nhsuk-tag--red">
                      Production
                    </strong>
                  </li>
                </ul>
                '
              }) }}

            </td>
          </tr>-->

          <!--<tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell" style="width:20%;">
              Assigned to
            </th>
            <td role="cell" class="nhsuk-table__cell">
              
              <ul>
                <li>
                  <a href="">Message name 1</a>
                  {{ tag({
                    text: "Draft",
                    classes: "nhsuk-tag--blue"
                  })}}
                </li>
                <li>
                  <a href="">Message name 2</a>
                  {{ tag({
                    text: "Draft",
                    classes: "nhsuk-tag--blue"
                  })}}
                </li>
                <li>
                  <a href="">Message name 3</a>
                  {{ tag({
                    text: "Production",
                    classes: "nhsuk-tag--red"
                  })}}
                </li>
              </ul>

              {{ details({
                text: "Show all messages",
                HTML: "
                <p>An NHS number is a 10 digit number, like 485 777 3456.</p>
                  <p>You can find your NHS number by logging in to a GP online service or on any document the NHS has sent you, such as your:</p>
                  <ul>
                      <li>prescriptions</li>
                      <li>test results</li>
                      <li>hospital referral letters</li>
                      <li>appointment letters</li>
                  </ul>
                  <p>Ask your GP surgery for help if you can't find your NHS number.</p>
                "
              }) }}

            </td>
          </tr>-->

        </tbody>
      </table>

      

      <table role="table" class="notify-template-content nhsuk-u-margin-bottom-6">
        <tbody class="nhsuk-table__body">

          <tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell" style="width:20%;">
              Subject line
            </th>
            <td role="cell" class="nhsuk-table__cell">
              {{ data['template-email-subject-1'] }}
            </td>
          </tr>

          <tr role="row" class="nhsuk-table__row">
            <th role="cell" class="nhsuk-table__cell" style="width:20%; border-bottom: none;">
              Message
            </th>
            <td role="cell" class="nhsuk-table__cell notify-template-email-message" style="border-bottom: none;">

              <textarea id="sourceTA">{{ data["template-email-message-1"] }}</textarea>
              <div id="targetDiv"></div>

            </td>
          </tr>

          {% if data['template-email-name-1-approved'] != '1' %}
          <tr role="row" class="nhsuk-table__row">

            <td role="cell" colspan="2" class="nhsuk-table__cell">

              <div class="nhsuk-warning-callout-nhs-notify nhsuk-u-padding-4">
                <p class=" nhsuk-u-margin-0">This is only a basic preview. <a href="template-test?message-type=email&continue-url=template-email-1?show-save-banner=no">Send a test email</a> to preview this template properly.</p>
              </div>
              
            </td>
          </tr>
          {% endif %}

        </tbody>
      </table>

      {% if data['template-email-name-1-approved'] != '1' %}

      <form action="route-template-next" method="post">

        {{ radios({
          "name": "template-next",
          "fieldset": {
            "legend": {
              "text": "What would you like to do next?",
              "classes": "nhsuk-fieldset__legend--m"
            }
          },
          "items": [
            {
              "value": "edit-email",
              "text": "Edit template"
            },
            {
              "value": "test-email",
              "text": "Send a test email"
            },
            {
              "value": "submit-email",
              "text": "Submit template"
            }
          ]
        }) }}

        <input type="hidden" name="approve-template-name" value="{{ data['template-email-name-1'] }}">
        <input type="hidden" name="message-type" value="email">
        <input type="hidden" name="continue-url" value="template-email-1?show-save-banner=no">

        {{ button({
          "text": "Continue"
        }) }}

      </form>

      <p><a href="templates">Back to all templates</a></p>

      {% else %}

      <p><a href="templates">Back to all templates</a></p>

      {% endif %}

    </div>
  </div>
{% endblock %}